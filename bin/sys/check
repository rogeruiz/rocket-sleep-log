#!/bin/bash

red='\033[1;31m'
yellow='\033[1;33m'
green='\033[0;32m'
NC='\033[0m' # No Color

NODE=`which node`
NPM=`which npm`
BOWER=`which bower`

FORCE_INSTALL=$1

echo -e "${green}✓${yellow}                                                                                                   ${green}✓${NC}";
echo -e "${green}✓${yellow}                                                                                                   ${green}✓${NC}";
echo -e "${green}✓${yellow}             ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓       ✓ ✓ ✓ ✓      ✓ ✓ ✓ ✓ ✓ ✓          ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓   ${green}✓${NC}";
echo -e "${green}✓${yellow}         ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓          ✓ ✓ ✓ ✓      ✓ ✓ ✓ ✓ ✓ ✓        ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓      ${green}✓${NC}";
echo -e "${green}✓${yellow}       ✓ ✓ ✓ ✓ ✓ ✓ ✓                   ✓ ✓ ✓ ✓      ✓ ✓ ✓ ✓ ✓ ✓       ✓ ✓ ✓ ✓ ✓ ✓ ✓                ${green}✓${NC}";
echo -e "${green}✓${yellow}     ✓ ✓ ✓ ✓ ✓ ✓ ✓                    ✓ ✓ ✓ ✓      ✓ ✓ ✓ ✓ ✓ ✓       ✓ ✓ ✓ ✓ ✓ ✓ ✓                 ${green}✓${NC}";
echo -e "${green}✓${yellow}       ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓           ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓           ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓       ${green}✓${NC}";
echo -e "${green}✓${yellow}         ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓           ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓               ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓     ${green}✓${NC}";
echo -e "${green}✓${yellow}                   ✓ ✓ ✓ ✓ ✓ ✓             ✓ ✓ ✓ ✓ ✓ ✓ ✓                             ✓ ✓ ✓ ✓ ✓ ✓   ${green}✓${NC}";
echo -e "${green}✓${yellow}                 ✓ ✓ ✓ ✓ ✓ ✓                 ✓ ✓ ✓ ✓ ✓                              ✓ ✓ ✓ ✓ ✓ ✓    ${green}✓${NC}";
echo -e "${green}✓${yellow}     ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓                   ✓ ✓ ✓ ✓                   ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓     ${green}✓${NC}";
echo -e "${green}✓${yellow} ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓                     ✓ ✓ ✓ ✓                 ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓ ✓         ${green}✓${NC}";
echo -e "${green}✓${yellow}                                                                                                   ${green}✓${NC}";
echo -e "${green}✓${yellow}                                                                                                   ${green}✓${NC}";

function install_dependencies {
  if [[ -n $FORCE_INSTALL && $FORCE_INSTALL == '--install' ]]; then
    $1 install;
  else
    echo -e "${yellow}[msg]: Do you want to run \`${2} install\`${NC}";
    select YN in "Sure" "No, thanks"; do
      case $YN in
        "Sure" ) $1 install; break;;
        "No, thanks" ) break;;
      esac
    done
  fi
}

# Let's check for Node and NPM and Bower, which are needed for the project.
if [[ $NODE && $NPM && $BOWER ]]; then
  echo -e "${green}[msg]: Node and Bower are installed!${NC}";

  # Let's see if the dependencies have been installed.
  if [ ! -d ./node_modules ]; then
    install_dependencies $NPM 'npm'
  fi
  if [ ! -d ./app/assets/vendor ]; then
    install_dependencies $BOWER 'bower'
  fi

  # Lastly, echo out the versions of Node and Bower.
  echo -e "${green}[msg]: node `node -v`${NC}";
  echo -e "${green}[msg]: bower `bower -v`${NC}";
  exit 0;

# If we don't have Bower but have Node, let's be helpful.
elif [[ ! $BOWER && $NPM ]]; then
  echo -e "${red}[msg]: Bower is not installed!${NC}";
  echo -e "${yellow}[msg]: Install Bower via NPM: \`npm i -g bower\`${NC}";
  exit 1;

# We can't do much of anything but help.
else
  echo -e "${red}[msg]: Neither Node nor Bower are installed!${NC}";
  echo -e "${yellow}[msg]: Install Node from: http://nodejs.org/${NC}";
  echo -e "${yellow}[msg]: Then, install Bower via NPM: \`npm i -g bower\`${NC}";
  exit 1;
fi

